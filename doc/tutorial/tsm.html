<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>TSM Server Installation Guide</title>
<!-- 2017-11-01 Wed 15:45 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Thomas Stibor" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="org.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">TSM Server Installation Guide</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. CentOS 7.2 and TSM Server 7.1.3</a>
<ul>
<li><a href="#sec-1-1">1.1. Stop and disable Firewall</a></li>
<li><a href="#sec-1-2">1.2. Verify that firewall is disabled</a></li>
<li><a href="#sec-1-3">1.3. Disable SELinux</a></li>
<li><a href="#sec-1-4">1.4. Install the following packages</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Install TSM Server</a>
<ul>
<li><a href="#sec-2-1">2.1. Download the latest TSM Server</a></li>
<li><a href="#sec-2-2">2.2. Console Installation</a></li>
<li><a href="#sec-2-3">2.3. Package Selection</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Login as user tsm and perform following steps</a>
<ul>
<li><a href="#sec-3-1">3.1. Create directory <code>tsm-server</code> and database instance for user tsm</a></li>
<li><a href="#sec-3-2">3.2. Create <code>dsmserv.opt</code> with following entries</a></li>
<li><a href="#sec-3-3">3.3. Initialize DB2 environment by adding following lines into <code>$HOME/.profile</code></a></li>
<li><a href="#sec-3-4">3.4. Create and format database and log locations</a></li>
<li><a href="#sec-3-5">3.5. Update file <code>userprofile</code> in <code>$HOME/sqllib/userprofile</code></a></li>
<li><a href="#sec-3-6">3.6. Install TSM Client for Testing</a></li>
<li><a href="#sec-3-7">3.7. Create file <code>/home/tsm/tsm-server/tsmdbmgr.opt</code> with content</a></li>
<li><a href="#sec-3-8">3.8. Create file <code>/opt/tivoli/tsm/client/api/bin64/dsm.sys</code> with content</a></li>
<li><a href="#sec-3-9">3.9. Start TSM Server</a></li>
<li><a href="#sec-3-10">3.10. Create admin account and grant access</a></li>
<li><a href="#sec-3-11">3.11. Login from any machine with admin account as follows</a></li>
<li><a href="#sec-3-12">3.12. Register license</a></li>
<li><a href="#sec-3-13">3.13. Set Servername and IP Address</a></li>
<li><a href="#sec-3-14">3.14. Create storage directory and TSM device class assigned to this directory</a></li>
<li><a href="#sec-3-15">3.15. Create TSM storage group and assign to device class <code>fsdir_devc</code></a></li>
<li><a href="#sec-3-16">3.16. Create TSM policyset and management class</a></li>
<li><a href="#sec-3-17">3.17. Create TSM copygroup for backup and archive</a></li>
<li><a href="#sec-3-18">3.18. Assign and activate TSM management class and policyset</a></li>
<li><a href="#sec-3-19">3.19. Register node and bind to domain</a></li>
</ul>
</li>
<li><a href="#sec-4">4. Perform an archiving task</a></li>
<li><a href="#sec-5">5. Frequent commands</a>
<ul>
<li><a href="#sec-5-1">5.1. Query space occupation</a></li>
<li><a href="#sec-5-2">5.2. Remove Node</a>
<ul>
<li><a href="#sec-5-2-1">5.2.1. Try to remove a node</a></li>
<li><a href="#sec-5-2-2">5.2.2. Query the filespace</a></li>
<li><a href="#sec-5-2-3">5.2.3. Delete filespace of node</a></li>
</ul>
</li>
<li><a href="#sec-5-3">5.3. Set Maximum Number of Mount Points</a></li>
<li><a href="#sec-5-4">5.4. Set Archive Delete Flag</a></li>
<li><a href="#sec-5-5">5.5. Update password and remove password expiration</a></li>
<li><a href="#sec-5-6">5.6. SQL query List fs,hl,ll</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Useful links</a>
<ul>
<li><a href="#sec-6-1">6.1. IBM documentation on TSM</a></li>
<li><a href="#sec-6-2">6.2. TSM Wiki</a></li>
<li><a href="#sec-6-3">6.3. Great Stuff about IBM Tivoli Storage Manager (TSM Monitor, SQL, TSM Scripts)</a></li>
<li><a href="#sec-6-4">6.4. TSM SQL Hints</a></li>
<li><a href="#sec-6-5">6.5. Lustre HSM copytool</a></li>
<li><a href="#sec-6-6">6.6. Lustre HSM architecture</a></li>
<li><a href="#sec-6-7">6.7. Lustre HSM Presentations</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> CentOS 7.2 and TSM Server 7.1.3</h2>
<div class="outline-text-2" id="text-1">
<p>
Setup e.g. in a KVM a CentOS 7.2 guest system with at least 12 GB RAM and 50 GB harddisk space.
The following KVM settings are used
</p>
<div class="org-src-container">

<pre class="src src-txt">&lt;network&gt;
  &lt;name&gt;kvmnatbr&lt;/name&gt;
  &lt;uuid&gt;12f40c73-3377-4b7b-a704-1e4e6a6f01db&lt;/uuid&gt;
  &lt;forward mode='nat'&gt;
    &lt;nat&gt;
      &lt;port start='1024' end='65535'/&gt;
    &lt;/nat&gt;
  &lt;/forward&gt;
  &lt;bridge name='kvmnatbr' stp='on' delay='0'/&gt;
  &lt;mac address='12:54:00:e4:56:7b'/&gt;
  &lt;domain name='kvm'/&gt;
  &lt;dns&gt;
    &lt;host ip='192.168.254.101'&gt;
      &lt;hostname&gt;tsm-centos-7-2&lt;/hostname&gt;
    &lt;/host&gt;
  &lt;/dns&gt;
  &lt;ip address='192.168.254.254' netmask='255.255.255.0'&gt;
    &lt;dhcp&gt;
      &lt;range start='192.168.254.1' end='192.168.254.253'/&gt;
      &lt;host mac='00:00:00:25:41:01' name='tsm-centos-7-2.kvm' ip='192.168.254.101'/&gt;
    &lt;/dhcp&gt;
  &lt;/ip&gt;
&lt;/network&gt;
</pre>
</div>
<p>
For installing the KVM instance following commands are executed
</p>
<div class="org-src-container">

<pre class="src src-sh">sudo qemu-img create -fqcow2 -o preallocation=metadata tsm-centos-7-2.qcow2 50G
sudo virt-install -d --name=tsm-centos-7-2 --ram 8192 --vcpu 2 --disk path=/home/kvm/tsm-centos-7-2.qcow2,bus=virtio,cache=none,format=qcow2 \
		  --network bridge=kvmnatbr,model=virtio,mac=00:00:00:25:41:01 --os-type=linux --location=http://mirror.centos.org/centos/7/os/x86_64 -k de
</pre>
</div>

<p>
During installation create a user and group named <code>tsm:tsm</code>.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Stop and disable Firewall</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">

<pre class="src src-sh">systemctl stop firewalld
systemctl disable firewalld
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Verify that firewall is disabled</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">

<pre class="src src-sh">iptables -L
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Disable SELinux</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Modify <code>SELINUX=enforcing</code> to <code>SELINUX=disabled</code> in file <code>/etc/sysconfig/selinux</code> to persistently
disable SELinux and verify after booting the settings with command
</p>
<div class="org-src-container">

<pre class="src src-sh">sestatus
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Install the following packages</h3>
<div class="outline-text-3" id="text-1-4">
<div class="org-src-container">

<pre class="src src-sh">yum install ksh libaio rsh lsscsi compat-glibc*
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Install TSM Server</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Download the latest TSM Server</h3>
<div class="outline-text-3" id="text-2-1">
<p>
IBM provides binary for Linux64 at <a href="ftp://ftp.software.ibm.com/storage/tivoli-storage-management/maintenance/server/v7r1/Linux/">ftp://ftp.software.ibm.com/storage/tivoli-storage-management/maintenance/server/v7r1/Linux/</a>.
Other versions (and other architectures) are provided here <a href="ftp://ftp.software.ibm.com/storage/tivoli-storage-management/maintenance/server/">ftp://ftp.software.ibm.com/storage/tivoli-storage-management/maintenance/server/</a>.
</p>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Console Installation</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">

<pre class="src src-sh">./install.sh -c -acceptLicense -vmargs "-DBYPASS_TSM_REQ_CHECKS=true"
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Package Selection</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">

<pre class="src src-txt">Select packages to install:
     1. [X] IBMÂ® Installation Manager 1.8.2.1
     2. [X] IBM Tivoli Storage Manager server 7.1.3.20150827_1628
     3. [ ] IBM Tivoli Storage Manager languages 7.1.3.20150827_1622
     4. [X] IBM Tivoli Storage Manager license 7.1.3.20150827_1621
     5. [X] IBM Tivoli Storage Manager storage agent 7.1.3.20150827_1621
     6. [X] IBM Tivoli Storage Manager device driver 7.1.3.20150827_1624
     7. [X] IBM Tivoli Storage Manager Operations Center 7.1.3000.20150821_0553
</pre>
</div>
<p>
Ignore the warnings and continue with default values by hitting N and accepting the license.
Choose a password and finally install product 1
</p>
<div class="org-src-container">

<pre class="src src-txt">Select the product that you purchased:
     1. IBM Tivoli Storage Manager
     2. IBM Tivoli Storage Manager Extended Edition
     3. IBM System Storage Archive Manager
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Login as user tsm and perform following steps</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Create directory <code>tsm-server</code> and database instance for user tsm</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">

<pre class="src src-sh">mkdir -p tsm-server &amp;&amp; cd tsm-server
sudo /opt/tivoli/tsm/db2/instance/db2icrt -a SERVER -s ese -u tsm tsm
/opt/tivoli/tsm/db2/bin/db2 update dbm cfg using dftdbpath /home/tsm/tsm-server
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Create <code>dsmserv.opt</code> with following entries</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">

<pre class="src src-sh">echo "DEVCONFIG /home/tsm/tsm-server/devconf.dat" &gt;&gt; /home/tsm/tsm-server/dsmserv.opt
echo "VOLUMEHISTORY /home/tsm/tsm-server/volhist.dat" &gt;&gt; /home/tsm/tsm-server/dsmserv.opt
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Initialize DB2 environment by adding following lines into <code>$HOME/.profile</code></h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">

<pre class="src src-txt">if [ -f /home/tsm/sqllib/db2profile ]; then
    . /home/tsm/sqllib/db2profile
fi
</pre>
</div>
<p>
and execute command
</p>
<div class="org-src-container">

<pre class="src src-sh">source $HOME/.profile
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> Create and format database and log locations</h3>
<div class="outline-text-3" id="text-3-4">
<div class="org-src-container">

<pre class="src src-sh">cd $HOME/tsm-server &amp;&amp; mkdir -p db &amp;&amp; mkdir -p log/active_log &amp;&amp; mkdir -p log/archive_log
$HOME/sqllib/adm/db2set -i tsm DB2CODEPAGE=819
dsmserv format dbdir=/home/tsm/tsm-server/db activelogsize=8196 activelogdir=/home/tsm/tsm-server/log/active_log archlogdir=/home/tsm/tsm-server/log/archive_log
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-5" class="outline-3">
<h3 id="sec-3-5"><span class="section-number-3">3.5</span> Update file <code>userprofile</code> in <code>$HOME/sqllib/userprofile</code></h3>
<div class="outline-text-3" id="text-3-5">
<div class="org-src-container">

<pre class="src src-txt">export DSMI_CONFIG=/home/tsm/tsm-server/tsmdbmgr.opt
export DSMI_DIR=/opt/tivoli/tsm/client/api/bin64
export DSMI_LOG=/home/tsm/tsm-server
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-6" class="outline-3">
<h3 id="sec-3-6"><span class="section-number-3">3.6</span> Install TSM Client for Testing</h3>
<div class="outline-text-3" id="text-3-6">
<div class="org-src-container">

<pre class="src src-sh">rpm --install /mnt/dvd/tsmcli/linux86/gskcrypt64-8.0.50.44.linux.x86_64.rpm
	      /mnt/dvd/tsmcli/linux86/gskssl64-8.0.50.44.linux.x86_64.rpm
	      /mnt/dvd/tsmcli/linux86/TIVsm-BA.x86_64.rpm
	      /mnt/dvd/tsmcli/linux86/TIVsm-API64.x86_64.rpm
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-7" class="outline-3">
<h3 id="sec-3-7"><span class="section-number-3">3.7</span> Create file <code>/home/tsm/tsm-server/tsmdbmgr.opt</code> with content</h3>
<div class="outline-text-3" id="text-3-7">
<div class="org-src-container">

<pre class="src src-txt">servername lxdv81-kvm-tsm-server
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-8" class="outline-3">
<h3 id="sec-3-8"><span class="section-number-3">3.8</span> Create file <code>/opt/tivoli/tsm/client/api/bin64/dsm.sys</code> with content</h3>
<div class="outline-text-3" id="text-3-8">
<div class="org-src-container">

<pre class="src src-txt">SERVERNAME lxdv81-kvm-tsm-server
NODENAME tsm-centos-7-2.kvm
TCPSERVERADDRESS 192.168.254.101
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-9" class="outline-3">
<h3 id="sec-3-9"><span class="section-number-3">3.9</span> Start TSM Server</h3>
<div class="outline-text-3" id="text-3-9">
<div class="org-src-container">

<pre class="src src-sh">dsmserv
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-10" class="outline-3">
<h3 id="sec-3-10"><span class="section-number-3">3.10</span> Create admin account and grant access</h3>
<div class="outline-text-3" id="text-3-10">
<div class="org-src-container">

<pre class="src src-sh">TSM:SERVER1&gt; register admin admin admin
TSM:SERVER1&gt; grant authority admin class=system
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-11" class="outline-3">
<h3 id="sec-3-11"><span class="section-number-3">3.11</span> Login from any machine with admin account as follows</h3>
<div class="outline-text-3" id="text-3-11">
<div class="org-src-container">

<pre class="src src-sh">dsmadmc -se=lxdv81-kvm-tsm-server -id=admin -password=admin
</pre>
</div>
<p>
and make sure file <code>/opt/tivoli/tsm/client/ba/bin/dsm.sys</code> has entries
</p>
<div class="org-src-container">

<pre class="src src-txt">SErvername lxdv81-kvm-tsm-server
   Nodename lxdv81
   TCPServeraddress 192.168.254.101
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-12" class="outline-3">
<h3 id="sec-3-12"><span class="section-number-3">3.12</span> Register license</h3>
<div class="outline-text-3" id="text-3-12">
<p>
Login with admin account as execute
</p>
<div class="org-src-container">

<pre class="src src-sh">register license file=/opt/tivoli/tsm/server/bin/tsmbasic.lic
register license file=/opt/tivoli/tsm/server/bin/tsmee.lic
register license file=/opt/tivoli/tsm/server/bin/dataret.lic

query license
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-13" class="outline-3">
<h3 id="sec-3-13"><span class="section-number-3">3.13</span> Set Servername and IP Address</h3>
<div class="outline-text-3" id="text-3-13">
<div class="org-src-container">

<pre class="src src-sh">dsmadmc -se=lxdv81-kvm-tsm-server -id=admin -password=admin
set servername lxdv81-kvm-tsm-server
set serverhladdress 192.168.254.101
q status
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-14" class="outline-3">
<h3 id="sec-3-14"><span class="section-number-3">3.14</span> Create storage directory and TSM device class assigned to this directory</h3>
<div class="outline-text-3" id="text-3-14">
<div class="org-src-container">

<pre class="src src-sh">mkdir /home/tsm/tsm-storage
</pre>
</div>
<div class="org-src-container">

<pre class="src src-sh">define devc fsdir_devc devt=file maxcap=15G dir=/home/tsm/tsm-storage
q devc
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-15" class="outline-3">
<h3 id="sec-3-15"><span class="section-number-3">3.15</span> Create TSM storage group and assign to device class <code>fsdir_devc</code></h3>
<div class="outline-text-3" id="text-3-15">
<div class="org-src-container">

<pre class="src src-sh">define stg fsdir_stg fsdir_devc maxscr=999
q stg
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">define domain 1year_domain archretention=365 backretention=365 description="1 year retention backup and archive"
define domain 10year_domain archretention=3650 backretention=3650 description="10 year retention backup and archive"
q domain
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-16" class="outline-3">
<h3 id="sec-3-16"><span class="section-number-3">3.16</span> Create TSM policyset and management class</h3>
<div class="outline-text-3" id="text-3-16">
<div class="org-src-container">

<pre class="src src-sh">define policyset 10year_domain fsdir10year_policyset
define policyset 1year_domain fsdir1year_policyset
q policyset f=d

define mgmtclass 10year_domain fsdir10year_policyset fsdir10year_mgmtclass
define mgmtclass 1year_domain fsdir1year_policyset fsdir1year_mgmtclass
q mgmtclass
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-17" class="outline-3">
<h3 id="sec-3-17"><span class="section-number-3">3.17</span> Create TSM copygroup for backup and archive</h3>
<div class="outline-text-3" id="text-3-17">
<div class="org-src-container">

<pre class="src src-sh">define copygroup 10year_domain fsdir10year_policyset fsdir10year_mgmtclass dest=fsdir_stg
define copygroup 10year_domain fsdir10year_policyset fsdir10year_mgmtclass dest=fsdir_stg type=archive

define copygroup 1year_domain fsdir1year_policyset fsdir1year_mgmtclass dest=fsdir_stg
define copygroup 1year_domain fsdir1year_policyset fsdir1year_mgmtclass dest=fsdir_stg type=archive

q copygroup
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-18" class="outline-3">
<h3 id="sec-3-18"><span class="section-number-3">3.18</span> Assign and activate TSM management class and policyset</h3>
<div class="outline-text-3" id="text-3-18">
<div class="org-src-container">

<pre class="src src-sh">assign defmgmt 10year_domain fsdir10year_policyset fsdir10year_mgmtclass
assign defmgmt 1year_domain fsdir1year_policyset fsdir1year_mgmtclass

q domain 10year_domain
q domain 1year_domain

activate policyset 10year_domain fsdir10year_policyset
activate policyset 1year_domain fsdir1year_policyset

q domain 10year_domain
q domain 1year_domain
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-19" class="outline-3">
<h3 id="sec-3-19"><span class="section-number-3">3.19</span> Register node and bind to domain</h3>
<div class="outline-text-3" id="text-3-19">
<div class="org-src-container">

<pre class="src src-sh">register node lxdv81 lxdv81 domain=10year_domain
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Perform an archiving task</h2>
<div class="outline-text-2" id="text-4">
<p>
In this example we clone the telescope guiding software <a href="http://openphdguiding.org/">PHD2</a> and archive the data
</p>
<div class="org-src-container">

<pre class="src src-sh">git clone https://github.com/OpenPHDGuiding/phd2
dsmc archive -subdir=yes -se=LXDV81-KVM-TSM-SERVER /home/tstibor/tsm-testing/to_archive/phd2/
IBM Tivoli Storage Manager
Command Line Backup-Archive Client Interface
  Client Version 7, Release 1, Level 3.1
  Client date/time: 01/28/2016 12:58:44
(c) Copyright by IBM Corporation and other(s) 1990, 2015. All Rights Reserved.

Node Name: LXDV81
Please enter your user id &lt;LXDV81&gt;: lxdv81

Please enter password for user id "LXDV81":

Session established with server LXDV81-KVM-TSM-SERVER: Linux/x86_64
  Server Version 7, Release 1, Level 3.0
  Server date/time: 01/28/2016 12:59:07  Last access: 01/28/2016 12:58:11

Archive function invoked.

ANS1898I ***** Processed       500 files *****
Directory--&gt;               4,096 /home [Sent]
Directory--&gt;               4,096 /home/tstibor [Sent]
Directory--&gt;               4,096 /home/tstibor/tsm-testing [Sent]
Directory--&gt;               4,096 /home/tstibor/tsm-testing/to_archive [Sent]
Directory--&gt;              12,288 /home/tstibor/tsm-testing/to_archive/phd2 [Sent]
Directory--&gt;               4,096 /home/tstibor/tsm-testing/to_archive/phd2/.git [Sent]
Directory--&gt;               4,096 /home/tstibor/tsm-testing/to_archive/phd2/WinLibs [Sent]
Directory--&gt;               4,096 /home/tstibor/tsm-testing/to_archive/phd2/build [Sent]
Directory--&gt;               4,096 /home/tstibor/tsm-testing/to_archive/phd2/cam_KWIQGuider [Sent]
...
...
Normal File--&gt;            12,288 /home/tstibor/tsm-testing/to_archive/phd2/thirdparty/openssag/usbtraffic/capture.txt [Sent]
Normal File--&gt;               345 /home/tstibor/tsm-testing/to_archive/phd2/thirdparty/openssag/usbtraffic/connect.txt [Sent]
Normal File--&gt;            20,664 /home/tstibor/tsm-testing/to_archive/phd2/thirdparty/openssag/usbtraffic/firmware.txt [Sent]
Archive processing of '/home/tstibor/tsm-testing/to_archive/phd2/*' finished without failure.


Total number of objects inspected:          828
Total number of objects archived:           828
Total number of objects updated:              0
Total number of objects rebound:              0
Total number of objects deleted:              0
Total number of objects expired:              0
Total number of objects failed:               0
Total number of objects encrypted:            0
Total number of objects grew:                 0
Total number of retries:                      0
Total number of bytes inspected:         142.17 MB
Total number of bytes transferred:       141.84 MB
Data transfer time:                        0.47 sec
Network data transfer rate:          305,236.54 KB/sec
Aggregate data transfer rate:         87,341.12 KB/sec
Objects compressed by:                        0%
Total data reduction ratio:                0.24%
Elapsed processing time:               00:00:01
</pre>
</div>
<p>
No we delete the data and retrieve the archive back
</p>
<div class="org-src-container">

<pre class="src src-sh">rm -rf phd2
dsmc retrieve -subdir=yes -se=LXDV81-KVM-TSM-SERVER /home/tstibor/tsm-testing/to_archive/phd2/
IBM Tivoli Storage Manager
Command Line Backup-Archive Client Interface
  Client Version 7, Release 1, Level 3.1
  Client date/time: 01/28/2016 13:03:59
(c) Copyright by IBM Corporation and other(s) 1990, 2015. All Rights Reserved.

Retrieve function invoked.

Node Name: LXDV81
Please enter your user id &lt;LXDV81&gt;: lxdv81

Please enter password for user id "LXDV81":

Session established with server LXDV81-KVM-TSM-SERVER: Linux/x86_64
  Server Version 7, Release 1, Level 3.0
  Server date/time: 01/28/2016 13:04:23  Last access: 01/28/2016 12:59:11

ANS1898I ***** Processed       500 files *****
Retrieving          12,288 /home/tstibor/tsm-testing/to_archive/phd2 [Done]
Retrieving           4,096 /home/tstibor/tsm-testing/to_archive/phd2/build [Done]
Retrieving           4,096 /home/tstibor/tsm-testing/to_archive/phd2/cameras [Done]
Retrieving           4,096 /home/tstibor/tsm-testing/to_archive/phd2/cam_KWIQGuider [Done]
Retrieving           4,096 /home/tstibor/tsm-testing/to_archive/phd2/cmake_modules [Done]
Retrieving           4,096 /home/tstibor/tsm-testing/to_archive/phd2/contributions [Done]
Retrieving           4,096 /home/tstibor/tsm-testing/to_archive/phd2/debian [Done]
Retrieving           4,096 /home/tstibor/tsm-testing/to_archive/phd2/extra_frameworks [Done]
Retrieving           4,096 /home/tstibor/tsm-testing/to_archive/phd2/.git [Done]
Retrieving           4,096 /home/tstibor/tsm-testing/to_archive/phd2/help [Done]
...
...
Retrieving           3,979 /home/tstibor/tsm-testing/to_archive/phd2/thirdparty/openssag/src/openssag.h [Done]
Retrieving           5,825 /home/tstibor/tsm-testing/to_archive/phd2/thirdparty/openssag/src/loader.cpp [Done]
Retrieving             203 /home/tstibor/tsm-testing/to_archive/phd2/thirdparty/openssag/src/commandline/Makefile.am [Done]
Retrieving           5,935 /home/tstibor/tsm-testing/to_archive/phd2/thirdparty/openssag/src/commandline/ssag.cpp [Done]
Retrieving          50,422 /home/tstibor/tsm-testing/to_archive/phd2/thirdparty/openssag/src/firmware.h [Done]
Retrieving           2,954 /home/tstibor/tsm-testing/to_archive/phd2/thirdparty/openssag/usbtraffic/bootloader.txt [Done]
Retrieving          12,288 /home/tstibor/tsm-testing/to_archive/phd2/thirdparty/openssag/usbtraffic/capture.txt [Done]
Retrieving             345 /home/tstibor/tsm-testing/to_archive/phd2/thirdparty/openssag/usbtraffic/connect.txt [Done]
Retrieving          20,664 /home/tstibor/tsm-testing/to_archive/phd2/thirdparty/openssag/usbtraffic/firmware.txt [Done]

Retrieve processing finished.

Total number of objects retrieved:          824
Total number of objects failed:               0
Total number of bytes transferred:       141.80 MB
Data transfer time:                        0.39 sec
Network data transfer rate:          367,024.11 KB/sec
Aggregate data transfer rate:         46,696.16 KB/sec
Elapsed processing time:               00:00:03
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Frequent commands</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Query space occupation</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">

<pre class="src src-sh">q occu
q occu type=backup
q occu type=archive
q occu lxdv81 type=archive
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Remove Node</h3>
<div class="outline-text-3" id="text-5-2">
</div><div id="outline-container-sec-5-2-1" class="outline-4">
<h4 id="sec-5-2-1"><span class="section-number-4">5.2.1</span> Try to remove a node</h4>
<div class="outline-text-4" id="text-5-2-1">
<div class="org-src-container">

<pre class="src src-sh">REMove Node lxdv81
Do you wish to proceed? (Yes (Y)/No (N)) Y
ANR2152E REMOVE NODE: Inventory references still exist for node LXDV81.
ANS8001I Return code 13.
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5-2-2" class="outline-4">
<h4 id="sec-5-2-2"><span class="section-number-4">5.2.2</span> Query the filespace</h4>
<div class="outline-text-4" id="text-5-2-2">
<div class="org-src-container">

<pre class="src src-sh">q filesp  lxdv81

Node Name           Filespace       FSID     Platform     Filespac-     Is Filesp-        Capacity      Pct
		    Name                                  e Type        ace Unico-                      Util
									   de?
---------------     -----------     ----     --------     ---------     ----------     -----------     -----
LXDV81              /                  1     Linux        EXT2              No              467 GB      70.9
					      x86-64
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5-2-3" class="outline-4">
<h4 id="sec-5-2-3"><span class="section-number-4">5.2.3</span> Delete filespace of node</h4>
<div class="outline-text-4" id="text-5-2-3">
<div class="org-src-container">

<pre class="src src-sh">delete filesp lxdv81 *
REMove Node lxdv81
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Set Maximum Number of Mount Points</h3>
<div class="outline-text-3" id="text-5-3">
<p>
By default, each node handles a single session. The TSM copytool however,
handles operations such as retrieve or archive in separate threads, where each thread has a separate session
to the TSM server. If you get the error message: <code>This node has exceeded its maximum number of mount points</code>,
make sure to set the parameter <code>maxnummp</code> to the value of maximum number of threads in the TSM copytool.
</p>
<div class="org-src-container">

<pre class="src src-sh">update node lxdv81 maxnummp=&lt;NUMBER_OF_THREADS&gt;
</pre>
</div>
<p>
The value <code>maxnummp</code> can be queried with command
</p>
<div class="org-src-container">

<pre class="src src-sh">q node lxdv81 f=d
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> Set Archive Delete Flag</h3>
<div class="outline-text-3" id="text-5-4">
<p>
To specifies whether a client node can delete its own archived files
from the server set:
</p>
<div class="org-src-container">

<pre class="src src-sh">update node lxdv81 archdelete=yes
</pre>
</div>
<p>
or
</p>
<div class="org-src-container">

<pre class="src src-sh">update node lxdv81 archdelete=no
</pre>
</div>
<p>
to disable deletion of the archive.
</p>
</div>
</div>
<div id="outline-container-sec-5-5" class="outline-3">
<h3 id="sec-5-5"><span class="section-number-3">5.5</span> Update password and remove password expiration</h3>
<div class="outline-text-3" id="text-5-5">
<div class="org-src-container">

<pre class="src src-sh">update node lxdv81 &lt;NEW_PW&gt;
update node lxdv81 passexp=0
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6" class="outline-3">
<h3 id="sec-5-6"><span class="section-number-3">5.6</span> SQL query List fs,hl,ll</h3>
<div class="outline-text-3" id="text-5-6">
<div class="org-src-container">

<pre class="src src-sh">dsmadmc -se=polaris-kvm-tsm-server -id=admin -password='&lt;MYPASSWD&gt;' -commadelimited "select FILESPACE_NAME,HL_NAME,LL_NAME from ARCHIVES WHERE NODE_NAME = '&lt;MY_NODE&gt;'"
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Useful links</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> IBM documentation on TSM</h3>
<div class="outline-text-3" id="text-6-1">
<ul class="org-ul">
<li><a href="http://web-docs.gsi.de/~tstibor/tsm/doc/ibm_tivoli_storage_management_concepts.pdf">IBM Tivoli Storage Management Concepts</a>
</li>
<li><a href="http://web-docs.gsi.de/~tstibor/tsm/doc/ibm_tivoli_storage_management_implementation_guide.pdf">IBM Tivoli Storage Management Implementation Guide</a>
</li>
<li><a href="http://web-docs.gsi.de/~tstibor/tsm/doc/using_the_programming_application_interface.pdf">API Using the Programming Application Interface</a>
</li>
<li><a href="http://web-docs.gsi.de/~tstibor/tsm/doc/IBM_beyond_backup_toward_storage_management_white_paper.pdf">IBM Beyond Backup Toward Storage Management White Paper</a>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> TSM Wiki</h3>
<div class="outline-text-3" id="text-6-2">
<ul class="org-ul">
<li><a href="http://emmanuel.iffly.free.fr/doku.php?id=tsm:tsm">http://emmanuel.iffly.free.fr/doku.php?id=tsm:tsm</a>
</li>
<li><a href="http://wiki.fysik.dtu.dk/it/TSM-server-configuration">TSM-server-configuration</a>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> Great Stuff about IBM Tivoli Storage Manager (TSM Monitor, SQL, TSM Scripts)</h3>
<div class="outline-text-3" id="text-6-3">
<ul class="org-ul">
<li><a href="http://thobias.org/tsm/">http://thobias.org/tsm/</a>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="section-number-3">6.4</span> TSM SQL Hints</h3>
<div class="outline-text-3" id="text-6-4">
<ul class="org-ul">
<li><a href="http://www.lascon.co.uk/tsm-sql-queries.php">http://www.lascon.co.uk/tsm-sql-queries.php</a>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-5" class="outline-3">
<h3 id="sec-6-5"><span class="section-number-3">6.5</span> Lustre HSM copytool</h3>
<div class="outline-text-3" id="text-6-5">
<ul class="org-ul">
<li><a href="http://sourceforge.net/projects/lustrehpss/">Lustre HPSS copytool</a>
</li>
<li><a href="http://git.hpdd.intel.com/fs/lustre-release.git/blob/HEAD:/lustre/utils/lhsmtool_posix.c">Lustre Posix copytool</a>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-6" class="outline-3">
<h3 id="sec-6-6"><span class="section-number-3">6.6</span> Lustre HSM architecture</h3>
<div class="outline-text-3" id="text-6-6">
<ul class="org-ul">
<li><a href="http://wiki.old.lustre.org/index.php/Architecture_-_HSM_Migration">Architecture HSM Migration</a>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6-7" class="outline-3">
<h3 id="sec-6-7"><span class="section-number-3">6.7</span> Lustre HSM Presentations</h3>
<div class="outline-text-3" id="text-6-7">
<ul class="org-ul">
<li><a href="https://w3.hepix.org/storage/hep_pdf/2010/Spring/Lustre-HSM_HEPIX.pdf">Lustre-HSM binding</a>
</li>
<li><a href="http://cdn.opensfs.org/wp-content/uploads/2015/04/Lustre-HSM-in-the-Cloud_Read.pdf">Lustre* HSM in the Cloud</a>
</li>
<li><a href="http://www.eofs.eu/fileadmin/lad2013/slides/10_Aurelien_Degremont_lustre_hsm_lad13.pdf">Lustre/HSM is there!</a>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Thomas Stibor</p>
<p class="date">Created: 2017-11-01 Wed 15:45</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.4.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
